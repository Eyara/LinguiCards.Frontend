<div class="level-section">
  <div class="level-card">
    <div class="level-header">
      <h2 class="level-title">–£—Ä–æ–≤–µ–Ω—å {{ level }}</h2>
      <div class="level-badge">{{ level }}</div>
    </div>
    <div class="xp-container">
      <mat-progress-bar
        class="xp-progress"
        [value]="roundToTwoDecimals((xp / xpToNextLevel) * 100)"
        color="primary"
      ></mat-progress-bar>
      <div class="xp-labels">
        <span class="xp-current">{{ xp }} XP</span>
        <span class="xp-total">{{ xpToNextLevel }} XP</span>
      </div>
    </div>
    <p class="xp-remaining">{{ xpToNextLevel - xp }} XP –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è</p>
  </div>  
</div>

<div class="daily-goal-section">
  <div class="daily-goal-card">
    <h2 class="daily-goal-title">–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ü–µ–ª—å XP</h2>
    
    <app-goal-streak [goalStreak]="goalStreak"></app-goal-streak>
    
    <div class="daily-progress-container" *ngIf="dailyGoalXp > 0">
      <h3 class="progress-section-title">–î–Ω–µ–≤–Ω–∞—è —Ü–µ–ª—å XP</h3>
      <mat-progress-bar
        class="daily-progress"
        [value]="(dailyXp / dailyGoalXp) * 100"
        color="accent"
      ></mat-progress-bar>
      <div class="daily-progress-labels">
        <span class="daily-xp-current">{{ dailyXp }} XP</span>
        <span class="daily-xp-goal">{{ dailyGoalXp }} XP</span>
      </div>
      <p class="daily-xp-remaining" *ngIf="dailyXp < dailyGoalXp">
        {{ dailyGoalXp - dailyXp }} XP –¥–æ —Ü–µ–ª–∏
      </p>
      <p class="daily-xp-completed" *ngIf="dailyXp >= dailyGoalXp">
        üéâ –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞!
      </p>
    </div>

    <div class="daily-progress-container" *ngIf="dailyGoalByTranslation > 0">
      <h3 class="progress-section-title">–¶–µ–ª—å –ø–æ –ø–µ—Ä–µ–≤–æ–¥–∞–º</h3>
      <mat-progress-bar
        class="daily-progress"
        [value]="(byTranslation / dailyGoalByTranslation) * 100"
        color="accent"
      ></mat-progress-bar>
      <div class="daily-progress-labels">
        <span class="daily-xp-current">{{ byTranslation }} XP</span>
        <span class="daily-xp-goal">{{ dailyGoalByTranslation }} XP</span>
      </div>
      <p class="daily-xp-remaining" *ngIf="byTranslation < dailyGoalByTranslation">
        {{ dailyGoalByTranslation - byTranslation }} XP –¥–æ —Ü–µ–ª–∏
      </p>
      <p class="daily-xp-completed" *ngIf="byTranslation >= dailyGoalByTranslation">
        üéâ –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞!
      </p>
    </div>

    <div class="daily-progress-container" *ngIf="dailyGoalByGrammar > 0">
      <h3 class="progress-section-title">–¶–µ–ª—å –ø–æ –≥—Ä–∞–º–º–∞—Ç–∏–∫–µ</h3>
      <mat-progress-bar
        class="daily-progress"
        [value]="(byGrammar / dailyGoalByGrammar) * 100"
        color="accent"
      ></mat-progress-bar>
      <div class="daily-progress-labels">
        <span class="daily-xp-current">{{ byGrammar }} XP</span>
        <span class="daily-xp-goal">{{ dailyGoalByGrammar }} XP</span>
      </div>
      <p class="daily-xp-remaining" *ngIf="byGrammar < dailyGoalByGrammar">
        {{ dailyGoalByGrammar - byGrammar }} XP –¥–æ —Ü–µ–ª–∏
      </p>
      <p class="daily-xp-completed" *ngIf="byGrammar >= dailyGoalByGrammar">
        üéâ –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞!
      </p>
    </div>

    <app-goal-calendar [completedGoalDays]="completedGoalDays"></app-goal-calendar>
    
    <div class="daily-goal-form">
      <mat-form-field appearance="outline">
        <mat-label>XP –≤ –¥–µ–Ω—å</mat-label>
        <input matInput type="number" [(ngModel)]="dailyGoalXp" min="0">
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>–¶–µ–ª—å –ø–æ –ø–µ—Ä–µ–≤–æ–¥–∞–º –≤ –¥–µ–Ω—å</mat-label>
        <input matInput type="number" [(ngModel)]="dailyGoalByTranslation" min="0">
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>–¶–µ–ª—å –ø–æ –≥—Ä–∞–º–º–∞—Ç–∏–∫–µ –≤ –¥–µ–Ω—å</mat-label>
        <input matInput type="number" [(ngModel)]="dailyGoalByGrammar" min="0">
      </mat-form-field>
      <button mat-raised-button color="primary" (click)="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </div>
</div>

<div class="settings-section">
  <div class="settings-card">
    <h2 class="settings-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h2>
    
    <div class="settings-form">
      <div class="form-field">
        <mat-form-field appearance="outline">
          <mat-label>–†–∞–∑–º–µ—Ä –∞–∫—Ç–∏–≤–Ω–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</mat-label>
          <input matInput type="number" [(ngModel)]="activeTrainingSize" min="0">
        </mat-form-field>
      </div>

      <div class="form-field">
        <mat-form-field appearance="outline">
          <mat-label>–†–∞–∑–º–µ—Ä –ø–∞—Å—Å–∏–≤–Ω–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</mat-label>
          <input matInput type="number" [(ngModel)]="passiveTrainingSize" min="0">
        </mat-form-field>
      </div>

      <button mat-raised-button color="primary" (click)="saveSettings()">
        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
      </button>
    </div>
  </div>
</div>

<ng-container *ngIf="languages$ | async as languages"></ng-container>
<ng-container *ngIf="userSettings$ | async as userSettings"></ng-container>
<ng-container *ngIf="saveUserSettings$ | async as saveUserSettings"></ng-container>
