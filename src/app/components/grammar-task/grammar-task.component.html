<div class="grammar-task-container">
  <mat-card class="settings-card">
    <mat-card-header>
      <mat-card-title>Настройки грамматического задания</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="settings-form">
        <mat-form-field appearance="outline">
          <mat-label>Уровень языка</mat-label>
          <mat-select [(ngModel)]="level">
            <mat-option *ngFor="let level of languageLevels" [value]="level.value">
              {{level.label}}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" *ngIf="taskTypes.length > 0">
          <mat-label>Тип задания</mat-label>
          <mat-select [(ngModel)]="selectedTypeName">
            <mat-option *ngFor="let taskType of taskTypes" [value]="taskType.name">
              {{taskType.description}}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Тема (необязательно)</mat-label>
          <input matInput [(ngModel)]="topic">
          <mat-hint>Введите тему для задания</mat-hint>
        </mat-form-field>

        <button mat-raised-button color="primary" (click)="getTask()" [disabled]="!level || (isLoadingTask$ | async)">
          <mat-spinner diameter="20" *ngIf="isLoadingTask$ | async" class="button-spinner"></mat-spinner>
          <span *ngIf="!(isLoadingTask$ | async)">Получить задание</span>
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <ng-container *ngIf="(evaluationResult$ | async) as evaluationResult; else practiceBlock">
    <mat-card class="result-card">
      <mat-card-header>
        <mat-card-title>Результаты оценки</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="result-section">
          <div class="evaluation-section">
            <h3>Оценка:</h3>
            <p class="evaluation-text">{{ evaluationResult }}</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </ng-container>

  <ng-template #practiceBlock>
    <mat-card class="practice-card" *ngIf="(taskText$ | async) as taskText">
      <mat-card-header>
        <mat-card-title>Грамматическое задание</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="text-section">
          <h3>Задание:</h3>
          <p class="task-text">{{ taskText }}</p>
        </div>
        <div class="answer-section">
          <mat-form-field appearance="outline" class="answer-input">
            <textarea matInput [(ngModel)]="userAnswer" rows="6" placeholder="Введите ваш ответ здесь..."></textarea>
          </mat-form-field>
          <button mat-raised-button color="primary" (click)="evaluateTask()" 
                  [disabled]="!userAnswer.trim() || (isLoadingEval$ | async)">
            <mat-spinner diameter="20" *ngIf="isLoadingEval$ | async" class="button-spinner"></mat-spinner>
            <span *ngIf="!(isLoadingEval$ | async)">Оценить ответ</span>
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </ng-template>
</div>

